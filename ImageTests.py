import time
from alpaca.camera import *

##b = b"\x01\x00\x00\x00\x00\x00\x00\x00\x16\x00\x00\x00A\x00\x00\x00,\x00\x00\x00\x02\x00\x00\x00\x08\x00\x00\x00\x02\x00\x00\x00\x00\x05\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\xb9\x00\xb3\x00\xb7\x00\xbf\x00\xbe\x00\xb4\x00\xb4\x00\xbc\x00\xc4\x00\xbe\x00\xb8\x00\xb6\x00\xbb\x00\xbf\x00\xbd\x00\xbb\x00\xb8\x00\xb6\x00\xb4\x00\xb6\x00\xbf\x00\xc1\x00\xc1\x00\xbf\x00\xbb\x00\xbb\x00\xbb\x00\xbd\x00\xc5\x00\xc7\x00\xc3\x00\xbd\x00\xc0\x00\xbe\x00\xba\x00\xba\x00\xbc\x00\xbc\x00\xbe\x00\xc8\x00\xc2\x00\xbe\x00\xb8\x00\xba\x00\xc0\x00\xc0\x00\xba\x00\xbc\x00\xba\x00\xbe\x00\xc5\x00\xc3\x00\xbf\x00\xbd\x00\xc5\x00\xc9\x00\xc9\x00\xc7\x00\xc3\x00\xc3\x00\xc5\x00\xc7\x00\xc4\x00\xc4\x00\xc3\x00\xc3\x00\xc1\x00\xbf\x00\xbb\x00\xbd\x00\xc3\x00\xc9\x00\xbe\x00\xbc\x00\xc0\x00\xc4\x00\xc2\x00\xc2\x00\xc2\x00\xbe\x00\xc7\x00\xc1\x00\xbf\x00\xc1\x00\xc1\x00\xc1\x00\xc5\x00\xcb\x00\xc3\x00\xc5\x00\xc7\x00\xc7\x00\xc7\x00\xc5\x00\xbf\x00\xbb\x00\xc2\x00\xc4\x00\xc8\x00\xc6\x00\xc2\x00\xbe\x00\xbc\x00\xbc\x00\xbe\x00\xbe\x00\xc0"
#b = b"\x01\x00\x00\x00\x00\x00\x00\x00\x16\x00\x00\x00A\x00\x00\x00,\x00\x00\x00\x02\x00\x00\x00\x08\x00\x00\x00\x02\x00\x00\x00\x00\x05\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\xb9\x00\xb3\x00\xb7\x00\xbf\x00\xbe\x00\xb4\x00\xb4\x00\xbc\x00\xc4\x00\xbe\x00\xb8\x00\xb6\x00\xbb\x00\xbf\x00\xbd\x00\xbb\x00\xb8\x00\xb6\x00\xb4\x00\xb6\x00\xbf\x00\xc1\x00\xc1\x00\xbf\x00\xbb\x00\xbb\x00\xbb\x00\xbd\x00\xc5\x00\xc7\x00\xc3\x00\xbd\x00\xc0\x00\xbe\x00\xba\x00\xba\x00\xbc\x00\xbc\x00\xbe\x00\xc8\x00\xc2\x00\xbe\x00\xb8\x00\xba\x00\xc0\x00\xc0\x00\xba\x00\xbc\x00\xba\x00\xbe\x00\xc5\x00\xc3\x00\xbf\x00\xbd\x00\xc5\x00\xc9\x00\xc9\x00\xc7\x00\xc3\x00\xc3\x00\xc5\x00\xc7\x00\xc4\x00\xc4\x00\xc3\x00\xc3\x00\xc1\x00\xbf\x00\xbb\x00\xbd\x00\xc3\x00\xc9\x00\xbe\x00\xbc\x00\xc0\x00\xc4\x00\xc2\x00\xc2\x00\xc2\x00\xbe\x00\xc7\x00\xc1\x00\xbf\x00\xc1\x00\xc1\x00\xc1\x00\xc5\x00\xcb\x00\xc3\x00\xc5\x00\xc7\x00\xc7\x00\xc7\x00\xc5\x00\xbf\x00\xbb\x00\xc2\x00\xc4\x00\xc8\x00\xc6\x00\xc2\x00\xbe\x00\xbc\x00\xbc\x00\xbe\x00\xbe\x00\xc0"
#MetadataVersion = int.from_bytes(b[0:4], 'little')
#ErrorNumber = int.from_bytes(b[4:8], 'little')
#ClientTransactionID = int.from_bytes(b[8:12], 'little')
#ServerTransactionID = int.from_bytes(b[12:16], 'little')
#DataStart = int.from_bytes(b[16:20], 'little')
#ImageElementType = int.from_bytes(b[20:24], 'little')
#TransmissionElementType = int.from_bytes(b[24:28], 'little')
#Rank = int.from_bytes(b[28:32], 'little')
#nx = int.from_bytes(b[32:36], 'little')
#ny = int.from_bytes(b[36:40], 'little')
#nz = int.from_bytes(b[40:44], 'little')

#print("done")

c = Camera('localhost:32323', 0)
c.Connected = True
c.BinX = 1 
c.BinY = 1
c.StartX = 0
c.StartY = 0
c.NumX = c.CameraXSize // c.BinX    # Watch it, this needs to be an int (typ)
c.NumY = c.CameraYSize // c.BinY
c.StartExposure(2.0, True)
while not c.ImageReady:
    time.sleep(0.5)
    print(f'{c.PercentCompleted}% complete')
print('finished')
img = c.ImageArray
print(f'{len(img)}x{len(img[0])} {type(img[0][0])}')
c.Connected = False
