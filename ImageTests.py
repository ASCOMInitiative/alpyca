import time
import array
from alpaca.camera import *

#b = b"\x01\x00\x02\x00\x03\x00\x04\x00"
#print(int.from_bytes(b[0:2], 'little'))
#a = array.array('i') #signed int (2 bytes)
#a.frombytes(b)
#print(a)

##b = b"\x01\x00\x00\x00\x00\x00\x00\x00\x16\x00\x00\x00A\x00\x00\x00,\x00\x00\x00\x02\x00\x00\x00\x08\x00\x00\x00\x02\x00\x00\x00\x00\x05\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\xb9\x00\xb3\x00\xb7\x00\xbf\x00\xbe\x00\xb4\x00\xb4\x00\xbc\x00\xc4\x00\xbe\x00\xb8\x00\xb6\x00\xbb\x00\xbf\x00\xbd\x00\xbb\x00\xb8\x00\xb6\x00\xb4\x00\xb6\x00\xbf\x00\xc1\x00\xc1\x00\xbf\x00\xbb\x00\xbb\x00\xbb\x00\xbd\x00\xc5\x00\xc7\x00\xc3\x00\xbd\x00\xc0\x00\xbe\x00\xba\x00\xba\x00\xbc\x00\xbc\x00\xbe\x00\xc8\x00\xc2\x00\xbe\x00\xb8\x00\xba\x00\xc0\x00\xc0\x00\xba\x00\xbc\x00\xba\x00\xbe\x00\xc5\x00\xc3\x00\xbf\x00\xbd\x00\xc5\x00\xc9\x00\xc9\x00\xc7\x00\xc3\x00\xc3\x00\xc5\x00\xc7\x00\xc4\x00\xc4\x00\xc3\x00\xc3\x00\xc1\x00\xbf\x00\xbb\x00\xbd\x00\xc3\x00\xc9\x00\xbe\x00\xbc\x00\xc0\x00\xc4\x00\xc2\x00\xc2\x00\xc2\x00\xbe\x00\xc7\x00\xc1\x00\xbf\x00\xc1\x00\xc1\x00\xc1\x00\xc5\x00\xcb\x00\xc3\x00\xc5\x00\xc7\x00\xc7\x00\xc7\x00\xc5\x00\xbf\x00\xbb\x00\xc2\x00\xc4\x00\xc8\x00\xc6\x00\xc2\x00\xbe\x00\xbc\x00\xbc\x00\xbe\x00\xbe\x00\xc0"
#a = array.array('l')
#a.frombytes(b"\x01\x00\x00\x00\x00\x00\x00\x00\x16\x00\x00\x00A\x00\x00\x00,\x00\x00\x00\x02\x00\x00\x00\x08\x00\x00\x00\x02\x00\x00\x00\x00\x05\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\xb9\x00\xb3\x00\xb7\x00\xbf\x00\xbe\x00\xb4\x00\xb4\x00\xbc\x00\xc4\x00\xbe\x00\xb8\x00\xb6\x00\xbb\x00\xbf\x00\xbd\x00\xbb\x00\xb8\x00\xb6\x00\xb4\x00\xb6\x00\xbf\x00\xc1\x00\xc1\x00\xbf\x00\xbb\x00\xbb\x00\xbb\x00\xbd\x00\xc5\x00\xc7\x00\xc3\x00\xbd\x00\xc0\x00\xbe\x00\xba\x00\xba\x00\xbc\x00\xbc\x00\xbe\x00\xc8\x00\xc2\x00\xbe\x00\xb8\x00\xba\x00\xc0\x00\xc0\x00\xba\x00\xbc\x00\xba\x00\xbe\x00\xc5\x00\xc3\x00\xbf\x00\xbd\x00\xc5\x00\xc9\x00\xc9\x00\xc7\x00\xc3\x00\xc3\x00\xc5\x00\xc7\x00\xc4\x00\xc4\x00\xc3\x00\xc3\x00\xc1\x00\xbf\x00\xbb\x00\xbd\x00\xc3\x00\xc9\x00\xbe\x00\xbc\x00\xc0\x00\xc4\x00\xc2\x00\xc2\x00\xc2\x00\xbe\x00\xc7\x00\xc1\x00\xbf\x00\xc1\x00\xc1\x00\xc1\x00\xc5\x00\xcb\x00\xc3\x00\xc5\x00\xc7\x00\xc7\x00\xc7\x00\xc5\x00\xbf\x00\xbb\x00\xc2\x00\xc4\x00\xc8\x00\xc6\x00\xc2\x00\xbe\x00\xbc\x00\xbc\x00\xbe\x00\xbe\x00")


#l = []
#rows = 4
#cols = 8
#planes = 3
#for i in range(rows):
#    rowidx = i * cols * planes
#    r = []
#    for j in range(cols):
#        colidx = j * planes
#        r.append(a[colidx:colidx+planes].tolist())
#    l.append(r)

#for i in range(rows):
#    row = i * cols
#    r = []
#    l.append(a[row:row+cols].tolist())

#print(l)

#print("done")

c = Camera('localhost:32323', 0)
c.Connected = True
c.BinX = 1 
c.BinY = 1
c.StartX = 0
c.StartY = 0
c.NumX = c.CameraXSize // c.BinX    # Watch it, this needs to be an int (typ)
c.NumY = c.CameraYSize // c.BinY
c.StartExposure(2.0, True)
while not c.ImageReady:
    time.sleep(0.5)
    print(f'{c.PercentCompleted}% complete')
print('finished')
img = c.ImageArray
print(f'{c.ImageArrayInfo.Dimension1} by {c.ImageArrayInfo.Dimension2}')
c.Connected = False
